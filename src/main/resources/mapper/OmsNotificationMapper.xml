<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.iaf.mapper.OmsNotificationMapper">

    <insert id="insertOmsNotification" parameterType="OmsNotification">
        INSERT INTO OMS_NOTIFICATION (base_date, client_id, oms_url, request_payload, status, error_message, elapsed_ms)
        VALUES (#{baseDate}, #{clientId}, #{omsUrl}, #{requestPayload}, #{status}, #{errorMessage}, #{elapsedMs})
    </insert>

    <select id="countOmsNotification" parameterType="SearchParam" resultType="int">
        SELECT COUNT(*)
        FROM OMS_NOTIFICATION h
        WHERE 1=1
        <if test="baseDate != null and baseDate != ''">
            AND h.base_date = #{baseDate}
        </if>
        <if test="clientId != null">
            AND h.client_id = #{clientId}
        </if>
        <if test="status != null and status != ''">
            AND h.status = #{status}
        </if>
    </select>

    <select id="selectOmsNotification" parameterType="SearchParam" resultType="OmsNotification">
        SELECT h.history_id, h.base_date, h.client_id, c.client_name, h.oms_url,
               h.request_payload, h.status, h.error_message, h.elapsed_ms, h.created_at
        FROM OMS_NOTIFICATION h
        LEFT JOIN CLIENT c ON h.client_id = c.client_id
        WHERE 1=1
        <if test="baseDate != null and baseDate != ''">
            AND h.base_date = #{baseDate}
        </if>
        <if test="clientId != null">
            AND h.client_id = #{clientId}
        </if>
        <if test="status != null and status != ''">
            AND h.status = #{status}
        </if>
        ORDER BY h.created_at DESC
        LIMIT #{pageSize} OFFSET #{offset}
    </select>

</mapper>
